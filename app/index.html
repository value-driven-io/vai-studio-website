<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAI QR Code Redirect</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            max-width: 400px;
        }
        .logo {
            width: 80px;
            height: 80px;
            background: #00c6ee;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        .loading {
            font-size: 18px;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        .spinner {
            border: 4px solid #1e293b;
            border-top: 4px solid #00c6ee;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">VAI</div>
        <div class="loading">Redirecting to paradise...</div>
        <div class="spinner"></div>
    </div>

    <script>
        // QR Code Tracking & Redirection System
        (function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const campaign = urlParams.get('c') || 'default';
            const source = urlParams.get('s') || 'qr';
            const medium = urlParams.get('m') || 'qr_code';
            const location = urlParams.get('l') || 'unknown';
            const timestamp = new Date().toISOString();
            
            // Generate unique session ID
            const sessionId = 'qr_' + Math.random().toString(36).substr(2, 9);
            
            // Tracking data
            const trackingData = {
                session_id: sessionId,
                campaign: campaign,
                source: source,
                medium: medium,
                location: location,
                timestamp: timestamp,
                user_agent: navigator.userAgent,
                referrer: document.referrer,
                screen_width: screen.width,
                screen_height: screen.height,
                language: navigator.language,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            // Track QR code scan
            async function trackQRScan() {
                try {
                    // Send to Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'qr_scan', {
                            campaign_name: campaign,
                            source: source,
                            medium: medium,
                            location: location,
                            session_id: sessionId
                        });
                    }
                    
                    // Send to Supabase (optional - for detailed tracking)
                    // This would require setting up a tracking table
                    /*
                    const response = await fetch('https://rizqwxcmpzhdmqjjqgyw.supabase.co/rest/v1/qr_scans', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': 'YOUR_SUPABASE_ANON_KEY'
                        },
                        body: JSON.stringify(trackingData)
                    });
                    */
                    
                    // Store in localStorage for later use
                    localStorage.setItem('vai_qr_tracking', JSON.stringify(trackingData));
                    
                } catch (error) {
                    console.error('Tracking error:', error);
                }
            }
            
            // Execute tracking
            trackQRScan();
            
            // Build redirect URL with UTM parameters
            const baseUrl = 'https://vai.studio/app/welcome/';
            const redirectUrl = new URL(baseUrl);
            
            // Add UTM parameters
            redirectUrl.searchParams.set('utm_source', source);
            redirectUrl.searchParams.set('utm_medium', medium);
            redirectUrl.searchParams.set('utm_campaign', campaign);
            redirectUrl.searchParams.set('utm_content', location);
            redirectUrl.searchParams.set('utm_term', 'qr_scan');
            redirectUrl.searchParams.set('session_id', sessionId);
            
            // Redirect after 2 seconds
            setTimeout(() => {
                window.location.href = redirectUrl.toString();
            }, 2000);
            
        })();
    </script>
</body>
</html>