var VAI=function(e){"use strict";const t={en:{close:"Close",loading:"Loading...",error:"Connection failed. Please try again.",bookingComplete:"Booking confirmed!"},fr:{close:"Fermer",loading:"Chargement...",error:"Échec de connexion. Veuillez réessayer.",bookingComplete:"Réservation confirmée !"}};function o(){return navigator.language.toLowerCase().startsWith("fr")?"fr":"en"}const r=e=>{const r=o();return t[r]?.[e]||t.en[e]||e},a=()=>o();function n(e){e.remove(),document.body.style.overflow="",e._escHandler&&document.removeEventListener("keydown",e._escHandler),e._previousFocus&&e._previousFocus.focus&&e._previousFocus.focus()}function i(e,t=r("error")){const o=e.querySelector(".vai-modal-content"),a=document.createElement("div");a.className="vai-modal-error",a.setAttribute("role","alert"),a.textContent=t,o.appendChild(a)}const d=(e,t={})=>{const o={event_name:e,timestamp:(new Date).toISOString(),source:"embed",...t};console.log("[VAI Analytics]",o)},s="1.0.0";function l(e){const t=function(e){return e.operatorId&&"string"==typeof e.operatorId?e.templateId&&"string"==typeof e.templateId?e.themeColor&&!/^#[0-9A-F]{6}$/i.test(e.themeColor)?{message:"themeColor must be a valid hex color (e.g., #FF5722)"}:null:{message:"templateId is required and must be a string"}:{message:"operatorId is required and must be a string"}}(e);if(t)return console.error("[VAI Embed]",t.message),d("embed.error",{operator_id:e.operatorId||"unknown",error:t.message}),null;const o=void 0!==e.darkMode?e.darkMode:function(){if(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)return!0;const e=document.documentElement,t=document.body,o=["dark","dark-mode","theme-dark"];for(const a of o)if(e.classList.contains(a)||t.classList.contains(a))return!0;const r=window.getComputedStyle(t).backgroundColor;if(r){const e=r.match(/\d+/g);if(e&&e.length>=3)return(299*parseInt(e[0])+587*parseInt(e[1])+114*parseInt(e[2]))/1e3<128}return!1}(),l=function(e=!1,t=null){const o=document.createElement("div");if(o.className="vai-modal-overlay"+(e?" dark-mode":""),o.setAttribute("role","dialog"),o.setAttribute("aria-modal","true"),o.setAttribute("aria-label","VAI Booking Modal"),t&&/^#[0-9A-F]{6}$/i.test(t)){o.style.setProperty("--vai-theme-color",t);const e=function(e){e=e.replace(/^#/,"");const t=parseInt(e.substring(0,2),16),o=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16),a=.85,n=Math.round(t*a),i=Math.round(o*a),d=Math.round(r*a);return`#${n.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}`}(t);o.style.setProperty("--vai-theme-color-dark",e)}return o.innerHTML=`\n    <div class="vai-modal-content">\n      <button\n        class="vai-modal-close"\n        aria-label="${r("close")}"\n        type="button"\n      >\n        <span aria-hidden="true">×</span>\n      </button>\n      <div class="vai-modal-loading" role="status" aria-live="polite">\n        ${r("loading")}\n      </div>\n    </div>\n  `,function(e){e.addEventListener("click",t=>{t.target===e&&n(e)}),e.querySelector(".vai-modal-close").addEventListener("click",()=>{n(e)});const t=o=>{"Escape"===o.key&&(n(e),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t),e._escHandler=t}(o),o}(o,e.themeColor),c=document.createElement("iframe");return c.className="vai-modal-iframe",c.src=function(e){const t=new URLSearchParams({embed:"true",operator_id:e.operatorId,lang:a(),version:s});return e.participants&&t.set("participants",e.participants),`http://localhost:3001/template/${e.templateId}?${t.toString()}`}(e),c.allow="payment",c.setAttribute("title","VAI Booking"),l.querySelector(".vai-modal-content").appendChild(c),function(e,t){const o=o=>{["http://localhost:3001","http://localhost:3001","http://localhost:5173","http://localhost:4173"].includes(o.origin)&&("vai:booking:complete"===o.data.type&&(d("embed.booking.completed",{operator_id:t.operatorId,template_id:t.templateId,booking_id:o.data.bookingId}),t.onBookingComplete&&"function"==typeof t.onBookingComplete&&t.onBookingComplete(o.data),setTimeout(()=>{e.remove(),document.body.style.overflow=""},2e3)),"vai:iframe:loaded"===o.data.type&&function(e){const t=e.querySelector(".vai-modal-loading");t&&(t.style.display="none")}(e),"vai:error"===o.data.type&&(i(e,o.data.message||r("error")),d("embed.error",{operator_id:t.operatorId,template_id:t.templateId,error:o.data.message})))};window.addEventListener("message",o),e.addEventListener("remove",()=>{window.removeEventListener("message",o)})}(l,e),c.addEventListener("error",()=>{i(l,r("error")),d("embed.iframe.error",{operator_id:e.operatorId,template_id:e.templateId})}),function(e){e._previousFocus=document.activeElement,document.body.appendChild(e),document.body.style.overflow="hidden";const t=e.querySelector(".vai-modal-close");t&&t.focus()}(l),d("embed.modal.opened",{operator_id:e.operatorId,template_id:e.templateId,dark_mode:o,theme_color:e.themeColor,language:a()}),l}function c(e){const t=document.createElement("button");return t.className="vai-booking-button",t.textContent=e.buttonText||"Book Now",t.type="button",t.addEventListener("click",()=>{l(e)}),d("embed.widget.loaded",{operator_id:e.operatorId,template_id:e.templateId,integration_method:"programmatic"}),t}function m(){document.querySelectorAll("[data-vai-operator][data-vai-template]").forEach(e=>{if(e.hasAttribute("data-vai-initialized"))return;e.setAttribute("data-vai-initialized","true");const t={operatorId:e.getAttribute("data-vai-operator"),templateId:e.getAttribute("data-vai-template"),participants:e.getAttribute("data-vai-participants")||void 0,themeColor:e.getAttribute("data-vai-theme")||void 0,darkMode:e.hasAttribute("data-vai-dark")?"true"===e.getAttribute("data-vai-dark"):void 0};e.addEventListener("click",e=>{e.preventDefault(),l(t)}),d("embed.widget.loaded",{operator_id:t.operatorId,template_id:t.templateId,integration_method:"data-attributes"})})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),new MutationObserver(e=>{for(const t of e)if("childList"===t.type&&t.addedNodes.length>0){m();break}}).observe(document.body,{childList:!0,subtree:!0});const u={createBookingButton:c,version:s};return"undefined"!=typeof window&&(window.VAI=window.VAI||{},window.VAI.createBookingButton=c,window.VAI.version=s),e.createBookingButton=c,e.default=u,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),e}({});//# sourceMappingURL=button.js.map
